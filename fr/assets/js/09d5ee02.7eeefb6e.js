(self.webpackChunkgo_mobile=self.webpackChunkgo_mobile||[]).push([[3940],{3905:function(e,t,n){"use strict";n.d(t,{Zo:function(){return u},kt:function(){return h}});var i=n(67294);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function a(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function s(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?a(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function r(e,t){if(null==e)return{};var n,i,o=function(e,t){if(null==e)return{};var n,i,o={},a=Object.keys(e);for(i=0;i<a.length;i++)n=a[i],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(i=0;i<a.length;i++)n=a[i],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var l=i.createContext({}),c=function(e){var t=i.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):s(s({},t),e)),n},u=function(e){var t=c(e.components);return i.createElement(l.Provider,{value:t},e.children)},p={inlineCode:"code",wrapper:function(e){var t=e.children;return i.createElement(i.Fragment,{},t)}},m=i.forwardRef((function(e,t){var n=e.components,o=e.mdxType,a=e.originalType,l=e.parentName,u=r(e,["components","mdxType","originalType","parentName"]),m=c(n),h=o,d=m["".concat(l,".").concat(h)]||m[h]||p[h]||a;return n?i.createElement(d,s(s({ref:t},u),{},{components:n})):i.createElement(d,s({ref:t},u))}));function h(e,t){var n=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var a=n.length,s=new Array(a);s[0]=m;var r={};for(var l in t)hasOwnProperty.call(t,l)&&(r[l]=t[l]);r.originalType=e,r.mdxType="string"==typeof e?e:o,s[1]=r;for(var c=2;c<a;c++)s[c]=n[c];return i.createElement.apply(null,s)}return i.createElement.apply(null,n)}m.displayName="MDXCreateElement"},61833:function(e,t,n){"use strict";n.r(t),n.d(t,{frontMatter:function(){return s},metadata:function(){return r},toc:function(){return l},default:function(){return u}});var i=n(22122),o=n(19756),a=(n(67294),n(3905)),s={id:"email-authentication",title:"Email authentication"},r={unversionedId:"extra-features/email-authentication",id:"extra-features/email-authentication",isDocsHomePage:!1,title:"Email authentication",description:"OBJECTIVES",source:"@site/i18n/fr/docusaurus-plugin-content-docs/current/extra-features/email-authentication.md",sourceDirName:"extra-features",slug:"/extra-features/email-authentication",permalink:"/go-mobile/fr/docs/extra-features/email-authentication",editUrl:"https://github.com/facebook/docusaurus/edit/master/website/docs/extra-features/email-authentication.md",version:"current",frontMatter:{id:"email-authentication",title:"Email authentication"},sidebar:"docs",previous:{title:"Deep Linking",permalink:"/go-mobile/fr/docs/extra-features/deep-linking"},next:{title:"Push notifications",permalink:"/go-mobile/fr/docs/extra-features/push-notification"}},l=[{value:"1. Activate the login form",id:"1-activate-the-login-form",children:[]},{value:"2. Enter your email address",id:"2-enter-your-email-address",children:[]},{value:"3. Check your mailbox",id:"3-check-your-mailbox",children:[]},{value:"4. Go back to your app",id:"4-go-back-to-your-app",children:[]},{value:"A component to deal with email authentication",id:"a-component-to-deal-with-email-authentication",children:[]},{value:"On Mobile App Authentification",id:"on-mobile-app-authentification",children:[]},{value:"Mobile App Active Session",id:"mobile-app-active-session",children:[]},{value:"On Mobile App Authentication",id:"on-mobile-app-authentication",children:[]},{value:"On Web connection",id:"on-web-connection",children:[]},{value:"Where to go from here?",id:"where-to-go-from-here",children:[]}],c={toc:l};function u(e){var t=e.components,s=(0,o.Z)(e,["components"]);return(0,a.kt)("wrapper",(0,i.Z)({},c,s,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("blockquote",null,(0,a.kt)("p",{parentName:"blockquote"},(0,a.kt)("strong",{parentName:"p"},"OBJECTIVES")),(0,a.kt)("p",{parentName:"blockquote"},"Integrate email confirmation to authenticate mobile app users")),(0,a.kt)("blockquote",null,(0,a.kt)("p",{parentName:"blockquote"},(0,a.kt)("strong",{parentName:"p"},"PREREQUISITES")),(0,a.kt)("p",{parentName:"blockquote"},"The ",(0,a.kt)("a",{parentName:"p",href:"https://github.com/4d-for-ios/4D-Mobile-App-Server"},"4D Mobile App Server")," component that allows email authentication is integrated in 4D mono and 4D server 18R4.")),(0,a.kt)("p",null,"Let your customers and clients feel comfortable logging into their app using the email authentication!"),(0,a.kt)("p",null,"It provides a way to verify that an email comes from whom it claims to be from, and will allow to block harmful or fraudulent uses of email."),(0,a.kt)("p",null,"In short, the principle is the following:"),(0,a.kt)("h3",{id:"1-activate-the-login-form"},"1. Activate the login form"),(0,a.kt)("p",null,"You integrate a login form into your app, from the project editor in the Publishing section."),(0,a.kt)("p",null,(0,a.kt)("img",{alt:"Email authentication activation",src:n(58653).Z})),(0,a.kt)("h3",{id:"2-enter-your-email-address"},"2. Enter your email address"),(0,a.kt)("p",null,'An email is required when the app is launched. When a user enters their email and clicks on the Login button, the On Mobile app Authentication is called and the user\'s session status should be updated to a "pending" status. A validation email is then sent to the user.'),(0,a.kt)("h3",{id:"3-check-your-mailbox"},"3. Check your mailbox"),(0,a.kt)("p",null,'When the validation email is available, the user only needs to click on the validation link. This will call the On Web Connection database method and update the user\'s session status from "pending" to "accepted".'),(0,a.kt)("h3",{id:"4-go-back-to-your-app"},"4. Go back to your app"),(0,a.kt)("p",null,'Once the validation is done, the user can reopen their app and click on the Login button. The On Mobile App Authentication is called again but this time, the user\'s session status is "accepted", so the access is granted!'),(0,a.kt)("p",null,"That\u2019s quite simple, right?"),(0,a.kt)("p",null,"So, to make the validation process easier and secure, 4D for iOS handles:"),(0,a.kt)("p",null,(0,a.kt)("img",{alt:"Authentication",src:n(49567).Z})),(0,a.kt)("p",null,"But let's figure out how this works, using our special component!"),(0,a.kt)("h1",{id:"using-the-component"},"Using the component"),(0,a.kt)("h2",{id:"a-component-to-deal-with-email-authentication"},"A component to deal with email authentication"),(0,a.kt)("p",null,"A toolbox component has been developed to help you manage several processes: the 4D Mobile App Server Component."),(0,a.kt)("p",null,"Let's see how to use it!"),(0,a.kt)("h2",{id:"on-mobile-app-authentification"},"On Mobile App Authentification"),(0,a.kt)("p",null,"Call the Mobile ",(0,a.kt)("strong",{parentName:"p"},"App Email Checker")," method in the ",(0,a.kt)("strong",{parentName:"p"},"On Mobile App Authentification database")," method with the information provided by the mobile application:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-4d"},"C_OBJECT($0)\nC_OBJECT($1)\n$0:= Mobile App Email Checker ($1)\n\n")),(0,a.kt)("h2",{id:"mobile-app-active-session"},"Mobile App Active Session"),(0,a.kt)("p",null,"Call the ",(0,a.kt)("strong",{parentName:"p"},"Activate sessions")," method in the ",(0,a.kt)("strong",{parentName:"p"},"On Web Connection")," database method with the Session ID parameter retrieved from the URL:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-4d"},"C_TEXT($1)\nCase of \n: (Mobile App Active Session($1).success)\n    //add log if you want\nEnd case \n\n")),(0,a.kt)("p",null,"Its as simple as that! You will find more information about this component in the ",(0,a.kt)("a",{parentName:"p",href:"https://github.com/4d-for-ios/4D-Mobile-App-Server/blob/master/Documentation/Methods/Mobile%20App%20Email%20Checker.md"},"documentation"),", especially about resources you may use, like html templates and settings that you may want to define."),(0,a.kt)("h1",{id:"without-the-component"},"Without the component"),(0,a.kt)("p",null,"We will see here a basic example without using the component."),(0,a.kt)("p",null,"To do so, here is the code you can use:"),(0,a.kt)("h2",{id:"on-mobile-app-authentication"},"On Mobile App Authentication"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-4d"},'C_OBJECT($0;$1;$response;$request;$email;$status)\n\n  // parameters settings come from the mobile app\n$request:=$1\n\n  // Create an email with an activation URL\n$mail:=New object\n$mail.from:="myapplication@gmail.com"\n$mail.to:=$request.email  // email entered by the user on their smartphone\n$mail.subject:="Login confirmation"\n$mail.htmlBody:="<a href=\\"https://myserverapplication/activation/"+$request.session.id \\\n+"\\">Click Here to confirm your email.</a>\\"<br>"\n\n  // Send mail\n$smtp:=New object("host";"smtp.gmail.com";"user";"myapplication@gmail.com";"password";"xxx")\n$transporter:=SMTP New transporter($smtp)\n$status:=$transporter.send($mail)\n\n  // Configure response for 4D for iOS\n$response:=New object\n\n  // Declare that the current session is being verified\n$response.verify:=True\n\n  // Check if the email was successsfully sent\nIf ($status.success)\n      //create a share object to contain our sessions, accessible from all processes\n    If (Storage.pendingSessions=Null)\n        Use (Storage)\n            Storage.pendingSessions:=New shared object\n        End use \n    End if \n\n    Use (Storage.pendingSessions)\n          //Add a session to our session lists\n        Storage.pendingSessions[$request.session.id]:=$request.team.id+"."+$request.application.id\n    End use \n\n    $response.success:=True\n    $response.statusText:="Please check your mail box"\nElse \n      // Display an error message on the smatphone\n    $response.statusText:="The mail is not sent please try again later"\n    $response.success:=False\nEnd if \n\n$0:=$response\n\n')),(0,a.kt)("h2",{id:"on-web-connection"},"On Web connection"),(0,a.kt)("p",null,"This method will allow you activate the session after clicking on the link in the confirmation email."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-4d"},'C_TEXT($1;$2;$3;$4;$5;$6)\n\nC_TEXT($token;$session)\nC_OBJECT($sessionFile;$sessionObject)\n\nIf ($1="/activation/@")\n    $token:=Substring($1;13)\nEnd if \n\n\n  //get session from ID received from URL\nIf (Storage.pendingSessions#Null)\n    $session:=Storage.pendingSessions[$token]\nEnd if \n\nIf ($session#"")\n      //get session folder\n    $sessionFile:=Folder(fk mobileApps folder).folder($session).file($token)\n    $sessionObject:=JSON Parse($sessionFile.getText())\n      //update status value\n    $sessionObject.status:="accepted"\n    $sessionFile.setText(JSON Stringify($sessionObject))\n    Use (Storage.pendingSessions)\n          //delete pending session\n        OB REMOVE(Storage.pendingSessions;$token)\n    End use \n\n    /*\n        The MOBILE APP REFRESH SESSIONS command checks all mobile\n        application session files located in the MobileApps folder of the server, \n        and updates existing session contents in memory for any edited files.\n    */\n\n    MOBILE APP REFRESH SESSIONS\n\n    WEB SEND TEXT("You are successfully authenticated")\nElse \n    WEB SEND TEXT("Invalid session")\nEnd if \n')),(0,a.kt)("p",null,"And that's it !"),(0,a.kt)("h2",{id:"where-to-go-from-here"},"Where to go from here?"),(0,a.kt)("p",null,"We've covered basic email validation in this tutorial. You should now be able to easily access your 4D for iOS app !"))}u.isMDXComponent=!0},49567:function(e,t,n){"use strict";t.Z=n.p+"assets/images/4D-for-iOS-email-auth-6e5d979a255eb468fc5d777636c9f442.png"},58653:function(e,t,n){"use strict";t.Z=n.p+"assets/images/email-authentication-publishing-section-da455833e642c84d558a940c75e83953.png"}}]);